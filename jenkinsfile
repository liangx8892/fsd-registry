#!groovy
node { 

	String DOCKER_REPO="registry.cn-shenzhen.aliyuncs.com/liangx8892"
	String DOCKER_REG="https://" + DOCKER_REPO + "/"
	String REG_CREDENTIAL_ID = "9caf828c-33c7-4dda-9abe-e7e186274d74"
	
	def PRODUCT_NAME=env.JOB_NAME.toLowerCase()
	
	String IMAGE_NAME="${PRODUCT_NAME}"
	String IMAGE_TAG=env.BUILD_NUMBER
	
	def customImage


    stage('Build') {
		sh 'mvn clean install'
    }
    
    stage('Build and push docker image') {
        echo 'Building docker image which contains jar package.'
        docker.withRegistry(DOCKER_REG,REG_CREDENTIAL_ID){
      		customImage = docker.build(DOCKER_REPO + "/" + IMAGE_NAME)    
      		customImage.push(IMAGE_TAG)
    	}
    }
    
    stage('Deploy') {
            echo 'Deploying....'
    }
}
